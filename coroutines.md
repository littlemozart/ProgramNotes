# Kotlin å¼‚æ­¥ç¼–ç¨‹ä¹‹ â€”â€” Coroutines

å…¶å®ï¼Œåç¨‹åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œæ¦‚å¿µã€‚åƒ go, python ä¹Ÿæœ‰åç¨‹çš„æ¦‚å¿µï¼Œåªä¸è¿‡ API ä¸å°½ç›¸åŒã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ

### 1. è½»é‡

> åç¨‹å°±åƒéå¸¸è½»é‡çº§çš„çº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯ç”±ç³»ç»Ÿè°ƒåº¦çš„ï¼Œçº¿ç¨‹åˆ‡æ¢æˆ–çº¿ç¨‹é˜»å¡çš„å¼€é”€éƒ½æ¯”è¾ƒå¤§ã€‚è€Œåç¨‹ä¾èµ–äºçº¿ç¨‹ï¼Œä½†æ˜¯åç¨‹æŒ‚èµ·æ—¶ä¸éœ€è¦é˜»å¡çº¿ç¨‹ï¼Œå‡ ä¹æ˜¯æ— ä»£ä»·çš„ï¼Œåç¨‹æ˜¯ç”±å¼€å‘è€…æ§åˆ¶çš„ã€‚æ‰€ä»¥åç¨‹ä¹Ÿåƒç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œéå¸¸è½»é‡çº§ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥åˆ›å»ºä»»æ„ä¸ªåç¨‹ã€‚

åç¨‹å¼€å‘äººå‘˜ Roman æ˜¯è¿™æ ·æè¿°åç¨‹çš„ã€‚å¦‚ä½•ç†è§£éå¸¸è½»çš„æ„æ€å‘¢ï¼Ÿä¸‹é¢ç®€å•ä¸¾ä¸ªæ —å­

```
val c = AtomicLong()

for (i in 1..1_000_000L)
    thread(start = true) {
        c.addAndGet(i)
    }

println(c.get())
```
è¿™é‡Œè¿è¡Œäº†ä¸€ç™¾ä¸‡ä¸ªçº¿ç¨‹å¹¶ä¸ºæ¯ä¸ªéƒ½å¢åŠ äº†ä¸€ä¸ªå…±åŒçš„è®¡æ•°å™¨ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šä¸€è¿è¡Œé£æ‰‡å°±ç‹‚è½¬ï¼Œå¯èƒ½ä¸€åˆ†é’Ÿéƒ½è¿è¡Œä¸å®Œ ğŸ˜‚

å†å¯¹æ¯”ä¸€ä¸‹åç¨‹:
```
val c = AtomicLong()

for (i in 1..1_000_000L)
    GlobalScope.launch {
        c.addAndGet(i)
    }

println(c.get())
```
è¿™æ®µä»£ç åœ¨ 1 ç§’å·¦å³å¯ä»¥è·‘å®Œã€‚

### 2. ä»£ç é£æ ¼æ›´æ¥è¿‘åŒæ­¥ä»£ç å—

å¼‚æ­¥ç¼–ç¨‹æ˜¯ç¨‹åºå‘˜å¿…å®šä¼šé‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šé€”å¾„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

- çº¿ç¨‹

çº¿ç¨‹åº”è¯¥ç›®å‰æœ€å¸¸è§çš„é¿å…åº”ç”¨ç¨‹åºé˜»å¡çš„æ–¹æ³•ã€‚ä½†æ˜¯çº¿ç¨‹æœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºé™·ï¼š

â€”â€” æ¯”è¾ƒé‡ï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡å¼€é”€å¤§ã€‚

â€”â€” å¯å¯åŠ¨çš„çº¿ç¨‹æ•°å—åº•å±‚æ“ä½œç³»ç»Ÿçš„é™åˆ¶ã€‚

â€”â€” ä¸€äº›å¹³å°ä¸­å¹¶ä¸æ”¯æŒçº¿ç¨‹ï¼Œå¦‚ JavaScript ã€‚

â€”â€” Debugï¼Œé¿å…ç«äº‰æ¡ä»¶ç­‰éº»çƒ¦ã€‚

- å›è°ƒ

æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨å¤„ç†å®Œæˆåè°ƒç”¨è¯¥å‡½æ•°ã€‚æ„Ÿè§‰æ˜¯ä¸€ä¸ªæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œä½†åˆæœ‰å‡ ä¸ªé—®é¢˜ï¼š

â€”â€” å›è°ƒåœ°ç‹±

â€”â€” é”™è¯¯å¤„ç†å¤æ‚

- Futures, Promise

èƒŒåæƒ³æ³•æ˜¯å½“æˆ‘ä»¬å‘èµ·è°ƒç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªå¯è¢«æ“ä½œçš„å¯¹è±¡ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š

â€”â€” ä¸å›è°ƒç±»ä¼¼ï¼Œç¼–ç¨‹æ¨¡å‹ä»è‡ªä¸Šè€Œä¸‹çš„å‘½ä»¤å¼æ–¹æ³•è½¬å˜ä¸ºå…·æœ‰é“¾å¼è°ƒç”¨çš„ç»„åˆæ¨¡å‹ï¼Œéœ€è¦å¯¹æˆ‘ä»¬çš„ç¼–ç¨‹æ–¹å¼è¿›è¡Œä¸€ç³»åˆ—æ›´æ”¹ã€‚

â€”â€” è¿”å›ç±»å‹è¿œç¦»ä¸æ˜¯æˆ‘ä»¬ç›´æ¥éœ€è¦çš„ç±»å‹ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå¿…é¡»è¢«å†…çœçš„æ–°ç±»å‹ `Promise` / `Futures` ã€‚

â€”â€” å¼‚å¸¸å¤„ç†ä¼šå¾ˆå¤æ‚ã€‚é”™è¯¯çš„ä¼ æ’­å’Œé“¾æ¥å¹¶ä¸æ€»æ˜¯ç›´æˆªäº†å½“çš„ã€‚

- å“åº”å¼æ‰©å±•ï¼ˆå¦‚Rxï¼‰

- åç¨‹

## åç¨‹å®ä½“ `Job` & `Deferred`
 
 A job has the following states:

| **State**                        | [isActive] | [isCompleted] | [isCancelled] |
| -------------------------------- | ---------- | ------------- | ------------- |
| _New_ (optional initial state)   | `false`    | `false`       | `false`       |
| _Active_ (default initial state) | `true`     | `false`       | `false`       |
| _Completing_ (transient state)   | `true`     | `false`       | `false`       |
| _Cancelling_ (transient state)   | `false`    | `false`       | `true`        |
| _Cancelled_ (final state)        | `false`    | `true`        | `true`        |
| _Completed_ (final state)        | `false`    | `true`        | `false`       |

```
                                      wait children
+-----+ start  +--------+ complete   +-------------+  finish  +-----------+
| New | -----> | Active | ---------> | Completing  | -------> | Completed |
+-----+        +--------+            +-------------+          +-----------+
                  |  cancel / fail       |
                  |     +----------------+
                  |     |
                  V     V
              +------------+                           finish  +-----------+
              | Cancelling | --------------------------------> | Cancelled |
              +------------+                                   +-----------+
```
 
## æŒ‚èµ·å‡½æ•° `suspend fun`

### suspend fun

### coroutineScope

### withContext

## async

## LifeCycleä¸­ä½¿ç”¨åç¨‹